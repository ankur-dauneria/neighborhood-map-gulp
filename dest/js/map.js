function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.7413549,lng:-73.9980244},zoom:13,styles:styles}),largeInfowindow=new google.maps.InfoWindow;var e=new ViewModel,a=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}});a.map?(a.setMap(null),null!==polygon&&polygon.setMap(null)):a.setMap(map),a.addListener("overlaycomplete",function(i){polygon&&(polygon.setMap(null),hideMarkers(markers)),a.setDrawingMode(null),(polygon=i.overlay).setEditable(!0),searchWithinPolygon(),polygon.getPath().addListener("set_at",searchWithinPolygon),polygon.getPath().addListener("insert_at",searchWithinPolygon),polygon.getPath().addListener("set_at",e.mapTags),polygon.getPath().addListener("insert_at",e.mapTags),e.mapTags()}),ko.applyBindings(e)}function ViewModel(){displayMarkers(locations);var e=this;this.selectItem=ko.observable(""),e.availableTags=ko.observableArray(locations),e.matchedTags=ko.observableArray([]),e.mapTags=function(){e.matchedTags.removeAll();for(var a=0;a<e.availableTags().length;a++)!0===e.availableTags()[a].marker.getVisible()&&e.matchedTags.push(e.availableTags()[a]);console.log(e.matchedTags().length)},e.setSelected=function(a){e.selectItem(a),google.maps.event.trigger(a.marker,"click")},e.tag=ko.observable().extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}}),e.tag.subscribe(function(a){if(e.matchedTags.removeAll(),""!==a){for(var i=0;i<e.availableTags().length;i++){e.availableTags()[i].name.toLowerCase().indexOf(a)>=0&&e.matchedTags.push(e.availableTags()[i])}if(0===e.matchedTags().length)for(i=0;i<e.availableTags().length;i++)for(var t=e.availableTags()[i].tag.length,l=0;l<t;l++)e.availableTags()[i].tag[l].toLowerCase().indexOf(a)>=0&&e.matchedTags.push(e.availableTags()[i]);if(e.matchedTags().length>0){for(i=0;i<e.availableTags().length;i++)aLocation=e.availableTags()[i],aLocation.marker.setVisible(!1);for(i=0;i<e.matchedTags().length;i++)aMatchedLocation=e.matchedTags()[i],aMatchedLocation.marker.setVisible(!0)}}else if(0!=e.availableTags().length)for(i=0;i<e.availableTags().length;i++)aLocation=e.availableTags()[i],aLocation.marker.setVisible(!0)})}function displayMarkers(e){for(var a=new google.maps.LatLngBounds,i=0;i<e.length;i++){latlng=new google.maps.LatLng(e[i].location.lat,e[i].location.lng);var t=e[i].name,l=new google.maps.Marker({map:map,position:latlng,title:t,animation:google.maps.Animation.DROP,id:i});markers.push(l),locations[i].marker=l,l.addListener("click",function(){populateInfoWindow(this,largeInfowindow)}),l.addListener("click",function(){toggleBounce(this)}),a.extend(markers[i].position)}map.fitBounds(a),google.maps.event.addDomListener(window,"resize",function(){map.fitBounds(a)})}function populateInfoWindow(e,a){a.marker!=e&&(a.marker=e,google.maps.event.addListener(e,"click",function(){load_content(map,this,a)}),a.addListener("closeclick",function(){a.setMarker=null}))}function load_content(map,marker,infowindow){function getData(callback){jQuery.ajax({url:wikiDataUrl,dataType:"jsonp",success:callback,error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");alert(err.Message)}})}var wikiUrl="http://en.wikipedia.org/w/api.php?action=query&format=json&prop=pageimages&titles="+marker.title+"    &format=json&pithumbsize=300&callback=wikiCallback",wikiDataUrl="https://www.wikidata.org/w/api.php?action=wbgetentities&format=json&ids=&sites=enwiki&titles="+marker.title+"    &props=info&languages=en&languagefallback=1&sitefilter=enwiki&formatversion=2&format=json&callback=wikiCallback",wikiRequestTimeout=setTimeout(function(){innerHTML+="<div>Failed too get wikipedia resources</div>",infowindow.setContent(innerHTML),infowindow.open(map,marker)},4e3);getData(function(response){function checkItsHeritageStatus(callback){jQuery.ajax({url:wikiDataUrl2,dataType:"jsonp",success:callback,error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");alert(err.Message)}})}clearTimeout(wikiRequestTimeout);var wikiDataId=Object.values(response.entities)[0].id,wikiDataUrl2="https://www.wikidata.org/w/api.php?action=wbgetentities&format=json&ids="+wikiDataId+"&sites=enwiki&titles=&props=claims&languages=en&languagefallback=1&sitefilter=enwiki&formatversion=2&format=json&callback=wikiCallback";checkItsHeritageStatus(function(data){function getP373(callback){jQuery.ajax({url:wikiP31ClaimIDURL,dataType:"jsonp",success:callback,error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");alert(err.Message)}})}clearTimeout(wikiRequestTimeout);var wikiClaimHeritage=Object.values(data.entities)[0].claims.P1435,wikiP31=Object.values(data.entities)[0].claims.P31,wikiP31ClaimValues=Object.values(wikiP31)[0],wikiP31ClaimValueID=wikiP31ClaimValues.mainsnak.datavalue.value.id,wikiP31ClaimIDURL="https://www.wikidata.org/w/api.php?action=wbgetentities&format=json&ids="+wikiP31ClaimValueID+"&sitefilter=enwiki&formatversion=2&format=json&callback=wikiCallback";getP373(function(data){function getHeritageIDStatus(callback){jQuery.ajax({url:wikiHeritageIDvalueURL,dataType:"jsonp",success:callback,error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");alert(err.Message)}})}clearTimeout(wikiRequestTimeout);var wikiP373IDValue=Object.values(data.entities)[0].claims.P373[0].mainsnak.datavalue.value;if(console.log(wikiP373IDValue),void 0!==wikiClaimHeritage){var wikiClaimValues=Object.values(wikiClaimHeritage)[0],wikiHeritageID=wikiClaimValues.mainsnak.datavalue.value.id,wikiHeritageIDvalueURL="https://www.wikidata.org/w/api.php?action=wbgetentities&format=json&ids="+wikiHeritageID+"&props=labels%7Cdescriptions&languages=&languagefallback=1&sitefilter=enwiki&formatversion=2&format=json&callback=wikiCallback";getHeritageIDStatus(function(data){clearTimeout(wikiRequestTimeout);var wikiHeritageIDValue=Object.values(data.entities)[0].labels.en.value;jQuery.ajax({url:wikiUrl,dataType:"jsonp",success:function(e){imageURL=Object.values(e.query.pages)[0].thumbnail.source,title=Object.values(e.query.pages)[0].title,heritageHTML='<div class="heritage">'+wikiHeritageIDValue+"</div>",buildingCategoryP373='<div class="p373ID">Site information: '+wikiP373IDValue+"</div>",wikipediaReference='<div align="right" class="text-muted wikiref">powered by wikipedia</div>',innerHTML='<div class="infoContainer"><img class="infoImage" src="'+imageURL+'"><h4 class="titleHeading">'+title+"</h4>"+heritageHTML+"<br>"+buildingCategoryP373+wikipediaReference+"</div>",infowindow.setContent(innerHTML),infowindow.open(map,marker),clearTimeout(wikiRequestTimeout)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");alert(err.Message)}})})}else jQuery.ajax({url:wikiUrl,dataType:"jsonp",success:function(e){imageURL=Object.values(e.query.pages)[0].thumbnail.source,title=Object.values(e.query.pages)[0].title,buildingCategoryP373='<div class="p373ID">Site information: '+wikiP373IDValue+"</div>",wikipediaReference='<div align="right" class="text-muted wikiref">powered by wikipedia</div>',innerHTML='<div class="infoContainer"><img class="infoImage" src="'+imageURL+'"><h4 class="titleHeading">'+title+"</h4><br>"+buildingCategoryP373+wikipediaReference+"</div>",infowindow.setContent(innerHTML),infowindow.open(map,marker),clearTimeout(wikiRequestTimeout)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");alert(err.Message)}})})})})}function searchWithinPolygon(){for(var e=0;e<locations.length;e++)google.maps.geometry.poly.containsLocation(locations[e].marker.position,polygon)?locations[e].marker.setVisible(!0):locations[e].marker.setVisible(!1)}function hideMarkers(e){for(var a=0;a<e.length;a++)e[a].setVisible(!1)}function toggleBounce(e){null!==e.getAnimation()?e.setAnimation(null):(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1400))}function errorHandling(){alert("Google Maps has failed to load. Please check console logs.")}var map,innerHTML="",markers=[],largeInfowindow,polygon=null,locations=[{tag:["places","historical","monument"],name:"Humayun's Tomb",location:{lat:28.593843,lng:77.250705}},{tag:["places","historical","monument"],name:"Qutb Minar",location:{lat:28.524758,lng:77.185424}},{tag:["places","historical","monument"],name:"Red Fort",location:{lat:28.656366,lng:77.24101}},{tag:["places","historical","monument"],name:"Tomb of Safdar Jang",location:{lat:28.589311,lng:77.210503}},{tag:["places","worship"],name:"Lotus Temple",location:{lat:28.553492,lng:77.258816}},{tag:["places","historical","war","memorial"],name:"India Gate",location:{lat:28.61295,lng:77.229456}},{tag:["places","historical","worship","muslim"],name:"Qila-i-Kuhna Mosque",location:{lat:28.609575,lng:77.243712}},{tag:["places","historical","worship","muslim"],name:"Jama Masjid, Delhi",location:{lat:28.650727,lng:77.233442}},{tag:["places","historical","worship","hindu"],name:"Laxminarayan Temple",location:{lat:28.632685,lng:77.198953}},{tag:["places","historical"],name:"Agrasen ki Baoli",location:{lat:28.626132,lng:77.224987}},{tag:["places","historical","worship","christian"],name:"Cathedral Church of the Redemption",location:{lat:28.618416,lng:77.201859}}],styles=[{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#f7f1df"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#d0e3b4"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"geometry",stylers:[{color:"#fbd3da"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#bde6ab"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffe15f"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efd151"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"black"}]},{featureType:"transit.station.airport",elementType:"geometry.fill",stylers:[{color:"#cfb2db"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#a2daf2"}]}];$(document).ready(function(){$('[data-toggle="offcanvas"]').click(function(){$(".row-offcanvas").toggleClass("active")})});